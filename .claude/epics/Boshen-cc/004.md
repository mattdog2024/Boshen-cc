---
name: Windows透明窗口绘制系统
status: open
created: 2025-10-28T08:08:33Z
updated: 2025-10-28T08:17:12Z
github: https://github.com/mattdog2024/Boshen-cc/issues/5
depends_on: [001]
parallel: true
conflicts_with: []
---

# Task: Windows透明窗口绘制系统

## Description
开发基于Windows API的透明窗口绘制系统，实现在文华行情软件窗口上叠加绘制红色预测线，支持窗口跟随和自动吸附。

## Acceptance Criteria
- [ ] 实现透明窗口创建和管理，支持点击穿透功能
- [ ] 开发GDI+绘制引擎，支持红色细线和重点线(3、6、8线加粗)绘制
- [ ] 实现窗口查找和位置跟随功能，自动吸附到文华窗口
- [ ] 添加价格标签绘制，在线条旁边显示具体价格数值
- [ ] 开发窗口管理服务，处理窗口移动、缩放、最小化等事件
- [ ] 实现线条清除功能，支持单个清除和全部清除
- [ ] 透明窗口性能优化，确保不影响原窗口操作流畅度

## Technical Details
- **Windows API调用**:
  - CreateWindowEx (创建分层窗口)
  - SetLayeredWindowAttributes (设置透明度)
  - UpdateLayeredWindow (更新分层窗口)
  - FindWindow (查找目标窗口)
- **绘制技术**:
  - GraphicsPath绘制抗锯齿线条
  - Font绘制价格标签
  - Pen设置线条样式和粗细
- **核心类**:
  ```csharp
  public class DrawingService
  {
      public IntPtr CreateTransparentOverlay(IntPtr targetWindow)
      public void DrawPredictionLines(List<PredictionLine> lines)
      public void UpdateOverlayPosition(IntPtr targetWindow)
      public void ClearAllLines()
  }
  ```

## Dependencies
- [ ] 任务001: 项目基础架构
- [ ] Windows API权限配置
- [ ] GDI+绘图库引用

## Effort Estimate
- Size: L
- Hours: 32
- Parallel: true

## Definition of Done
- [ ] 透明窗口可以正常创建和显示
- [ ] 线条绘制清晰，颜色和粗细符合要求
- [ ] 窗口跟随功能正常，无延迟
- [ ] 清除功能响应迅速
- [ ] 多显示器环境下工作正常
- [ ] 内存泄漏测试通过